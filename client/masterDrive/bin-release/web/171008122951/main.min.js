var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Car=function(t){function e(){var e=t.call(this)||this;return e._rect=new egret.Rectangle(0,0,0,0),e.speedHUnit=10,e.speedH=0,e.speedV=0,e._alive=!0,e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.body=UIHelper.getCarBMP("1",UIHelper.getRandomColor()),this.addChild(this.body)},e.prototype.initView=function(){var t=Constants.spaceLW-40,e=this.stage.stageWidth,i=(this.stage.stageHeight,t/this.body.width);this.body.width=i*this.body.width,this.body.height=i*this.body.height;var r=3*Math.random();r>=0&&1>r?this.x=e/2-this.body.width/3*2:r>=1&&2>r?this.x=e/2-2*this.body.width:this.x=e/2+this.body.width/2,this.y=-30-this.body.height,this._rect.width=this.body.width-10,this._rect.height=this.body.height-10},e.prototype.initAI=function(t,e){this.speedV=t,this.speedH=e},e.prototype.enterframe=function(){this.y>this.stage.stageHeight&&(console.log("i am dead"),this._alive=!1),this.y+=this.speedV,this.x+=this.speedH*this.speedHUnit},Object.defineProperty(e.prototype,"alive",{get:function(){return this._alive},enumerable:!0,configurable:!0}),e.prototype.destory=function(){this.removeChild(this.body)},Object.defineProperty(e.prototype,"rect",{get:function(){return this._rect.x=this.x+5,this._rect.y=this.y+5,this._rect},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Car.prototype,"Car");var EuiComponent=function(t){function e(){var e=t.call(this)||this,i=getClassName(e);return e.addEventListener(egret.Event.COMPLETE,e._uiCompHandler,e),e.skinName="resource/skins/"+i+"Skin.exml",e}return __extends(e,t),e.prototype._uiCompHandler=function(){this.removeEventListener(egret.Event.COMPLETE,this._uiCompHandler,this),this.addTapListener(),this.uiCompHandler&&this.uiCompHandler()},e.prototype.removeBtnListeners=function(){for(var t=0;t<this._btnArr.length;t++){var e=this.skin[this._btnArr[t]];this["_tap_"+this._btnArr[t]]&&e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this["_tap_"+this._btnArr[t]],this)}},e.prototype.addTapListener=function(){for(var t,e=Object.keys(this.skin),i=0,r=[];i<e.length;i++){var t=e[i];if(0==t.indexOf("btn_")){var n=getClassName(this.skin[e[i]]);n.indexOf("Button")>-1&&r.push(t)}}for(this._btnArr=r,i=0;i<r.length;i++){var s=this.skin[r[i]];this["_tap_"+r[i]]&&s.addEventListener(egret.TouchEvent.TOUCH_TAP,this["_tap_"+r[i]],this)}},e.prototype.uiCompHandler=function(){},e.prototype.updateUI=function(t){},e}(eui.Component);__reflect(EuiComponent.prototype,"EuiComponent");var ToucheLayer=function(t){function e(){var e=t.call(this)||this;return e.leftTap=!1,e.rightTap=!1,e._direction=0,e.rightTouchPad=UIHelper.createBitmapByName("empty_png"),e.leftTouchPad=UIHelper.createBitmapByName("empty_png"),e.addChild(e.leftTouchPad),e.addChild(e.rightTouchPad),e.leftTouchPad.touchEnabled=!0,e.leftTouchPad.addEventListener(egret.TouchEvent.TOUCH_TAP,e.goLeft,e),e.rightTouchPad.touchEnabled=!0,e.rightTouchPad.addEventListener(egret.TouchEvent.TOUCH_TAP,e.goRight,e),e}return __extends(e,t),e.prototype.goLeft=function(){return this._direction>0?void(this._direction=0):void this._direction--},e.prototype.goRight=function(){return this._direction<0?void(this._direction=0):void this._direction++},Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),e.prototype.initData=function(){this._direction=0},e.prototype.initView=function(){this.height=this.stage.stageHeight,this.width=this.stage.stageWidth,this.leftTouchPad.height=this.height,this.leftTouchPad.width=this.width/2,this.rightTouchPad.height=this.height,this.rightTouchPad.width=this.width/2,this.rightTouchPad.x=this.width/2},e}(egret.Sprite);__reflect(ToucheLayer.prototype,"ToucheLayer");var EnermyFactory=function(){function t(){}return t.createEnermy=function(e){if((new Date).getTime()-t.lastEnermyTime>t.timeSpace){t.lastEnermyTime=(new Date).getTime();var i=new Car;return e.addChild(i),i.initView(),i.initAI(gc.gameCenter.enermySpeed,0),i}return null},t.init=function(){t.lastEnermyTime=0},t.timeSpace=5e3,t}();__reflect(EnermyFactory.prototype,"EnermyFactory");var gc;!function(t){}(gc||(gc={}));var GameCenter=function(){function t(){this._cur_status=0,this.enermys=[],this.MAX_ENERMY_SPEED=[8,12,16,20,24,28,32,36,40,44],this.MAX_SPEED=[10,20,30,40,50,60,70,80,90,100],this.MAX_SPEED_TIME=[5e3,15e3,25e3,4e4,55e3,7e4,9e4,13e4,16e4,2e5],this.initData()}return t.prototype.initData=function(){this._speed=0,this._time=0,this._distance=0,this._lastTime=(new Date).getTime()},t.prototype.initLayer=function(t,e,i,r){this._bgLayer=t,this._uiLayer=i,this._carLayer=e,this._touchLayer=r,this.addBG(),this._mycar=new MyCar,this._carLayer.addChild(this._mycar),Constants.spaceLW=this._bg.spaceLW,this._mycar.initView(),this.toucheLayer=new ToucheLayer,this._touchLayer.addChild(this.toucheLayer),this.toucheLayer.initView()},t.prototype.mainLoop=function(){switch(gc.gameCenter.cur_status){case t.STATUS_RUNNING:this.toucheLayer.visible=!0,this.loop(),this._bg.enterframe(),this._mycar.updateDirectionH(this.toucheLayer.direction),this._mycar.enterframe(),this.enermys.map(function(t){return t.enterframe()}),this.checkDead();var e=EnermyFactory.createEnermy(this._carLayer);e&&this.enermys.push(e),gc.uiController.cur_layer.updateUI(null);break;case t.STATUS_DIE:this.toucheLayer.visible=!1;break;case t.STATUS_NOT_READY:this.toucheLayer.visible=!1;break;default:this.toucheLayer.visible=!1}},t.prototype.loop=function(){var t=(new Date).getTime(),e=t-this._lastTime;this._distance+=e*this.speed/1e3,this._time+=e,this._lastTime=t},t.prototype.restartGame=function(){this.initData(),EnermyFactory.init(),this._mycar.initView(),this.toucheLayer.initData();for(var t=0;t<this.enermys.length;t++){var e=this.enermys[t];e.destory(),this._carLayer.removeChild(e)}this.enermys=[],gc.uiController.showLayer(UIConsts.LAYER_GAMING)},t.prototype.openGame=function(){gc.uiController.showLayer(UIConsts.LAYER_START_GAME)},t.prototype.startGame=function(){this.restartGame()},Object.defineProperty(t.prototype,"lastTime",{get:function(){return this._lastTime},set:function(t){this._lastTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this.MAX_SPEED[this.getSpeedIndex()]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return Math.round(this._distance)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enermySpeed",{get:function(){return this.MAX_ENERMY_SPEED[this.getSpeedIndex()]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cur_status",{get:function(){return this._cur_status},set:function(t){this._cur_status=t},enumerable:!0,configurable:!0}),t.prototype.getSpeedIndex=function(){for(var t=0,e=this.MAX_SPEED_TIME.length;e>t;t++)if(this._time<this.MAX_SPEED_TIME[t])return t;return t},t.prototype.addBG=function(){this._bg=new Background,this._bgLayer.addChild(this._bg),this._bg.initView()},t.prototype.checkDead=function(){for(var e=0;e<this.enermys.length;e++)if(this.collision(this._mycar.rect,this.enermys[e].rect)){gc.gameCenter.cur_status=t.STATUS_DIE,gc.uiController.showLayer(UIConsts.LAYER_GAME_OVER);break}var i=[];this.enermys.map(function(t){t.alive||i.push(t)});for(var e=0;e<i.length;e++){var r=i[e];this.enermys.splice(this.enermys.indexOf(r),1),r.destory(),this._carLayer.removeChild(r)}},t.prototype.collision=function(t,e){return t.intersects(e)},t.STATUS_RUNNING=1,t.STATUS_DIE=2,t.STATUS_NOT_READY=3,t}();__reflect(GameCenter.prototype,"GameCenter");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e._isDebug=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.init(),gc.gameCenter.openGame()},e.prototype.init=function(){Constants.stageH=this.stage.stageHeight,Constants.stageW=this.stage.stageWidth;var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this._bgLayer=new egret.DisplayObjectContainer,this._carLayer=new egret.DisplayObjectContainer,this._uiLayer=new egret.DisplayObjectContainer,this._touchLayer=new egret.DisplayObjectContainer,this.addChild(this._bgLayer),this.addChild(this._carLayer),this.addChild(this._uiLayer),this.addChild(this._touchLayer),gc.gameCenter=new GameCenter,gc.gameCenter.initLayer(this._bgLayer,this._carLayer,this._uiLayer,this._touchLayer),gc.uiController=new UIController(this._uiLayer),Toast.init(this,RES.getRes("toast_bg_png")),this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this)},e.prototype.loop=function(){var t=(new Date).getTime(),e=t-gc.gameCenter.lastTime;return e>100?void(gc.gameCenter.lastTime=(new Date).getTime()):void gc.gameCenter.mainLoop()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var MyCar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createView=function(){this.body=UIHelper.getCarBMP("1",UIHelper.RED),this.addChild(this.body)},e.prototype.initView=function(){var t=Constants.spaceLW-40,e=this.stage.stageWidth,i=this.stage.stageHeight,r=t/this.body.width;this.body.width=r*this.body.width,this.body.height=r*this.body.height,this.x=e/2-this.body.width/2,this.y=i-this.body.height-30,this._rect.width=this.body.width-10,this._rect.height=this.body.height-10},e.prototype.updateDirectionH=function(t){this.speedH=t},e}(Car);__reflect(MyCar.prototype,"MyCar");var StatusEvent=function(t){function e(e,i,r){return void 0===i&&(i=!1),void 0===r&&(r=!1),t.call(this,e,i,r)||this}return __extends(e,t),e.GAME_STATUS_CHANGE="game_status_change",e}(egret.Event);__reflect(StatusEvent.prototype,"StatusEvent");var Background=function(t){function e(){var e=t.call(this)||this;return e.lineMargin=80,e._speed=100,e.createView(),e}return __extends(e,t),e.prototype.initView=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;this.stageH=e,this.stageW=t,this.bm3.height=e,this.bm3.width=t,this.bm1.x=this.lineMargin-this.bm1.width/2,this.bm2.x=t-this.lineMargin-this.bm1.width/2,this.bm1.height=e,this.bm2.height=e,this._spaceLW=(t-2*this.lineMargin)/3,this.lineLeft1.x=this._spaceLW+this.lineMargin-this.bm1.width/2,this.lineLeft2.x=2*this._spaceLW+this.lineMargin-this.bm1.width/2,this.lineLeft3.x=2*this._spaceLW+this.lineMargin-this.bm1.width/2,this.lineRight1.x=2*this._spaceLW+this.lineMargin-this.bm1.width/2,this.lineRight2.x=this._spaceLW+this.lineMargin-this.bm1.width/2,this.lineRight3.x=this._spaceLW+this.lineMargin-this.bm1.width/2;var i=e/2*2/3;this.lineH=i;var r=i/2;this.spaceH=r,this.lineLeft1.height=i,this.lineLeft2.height=i,this.lineLeft3.height=i,this.lineRight1.height=i,this.lineRight2.height=i,this.lineRight3.height=i,this.lineLeft1.y=r/2,this.lineLeft2.y=r/2+r+i,this.lineLeft3.y=-(r/2+i),this.lineRight1.y=r/2,this.lineRight2.y=r/2+r+i,this.lineRight3.y=-(r/2+i)},e.prototype.createView=function(){this.bm1=UIHelper.createBitmapByName("white_png"),this.bm2=UIHelper.createBitmapByName("white_png"),this.bm3=UIHelper.createBitmapByName("black_png"),this.addChild(this.bm3),this.addChild(this.bm1),this.addChild(this.bm2),this.lineLeft1=UIHelper.createBitmapByName("white_png"),this.lineLeft2=UIHelper.createBitmapByName("white_png"),this.lineLeft3=UIHelper.createBitmapByName("white_png"),this.lineRight1=UIHelper.createBitmapByName("white_png"),this.lineRight2=UIHelper.createBitmapByName("white_png"),this.lineRight3=UIHelper.createBitmapByName("white_png"),this.addChild(this.lineLeft1),this.addChild(this.lineLeft2),this.addChild(this.lineLeft3),this.addChild(this.lineRight1),this.addChild(this.lineRight2),this.addChild(this.lineRight3)},e.prototype.enterframe=function(){this._speed=gc.gameCenter.speed,this.turnTop(this.lineLeft1),this.turnTop(this.lineLeft2),this.turnTop(this.lineLeft3),this.turnTop(this.lineRight1),this.turnTop(this.lineRight2),this.turnTop(this.lineRight3),this.lineLeft1.y+=this._speed,this.lineLeft2.y+=this._speed,this.lineLeft3.y+=this._speed,this.lineRight1.y+=this._speed,this.lineRight2.y+=this._speed,this.lineRight3.y+=this._speed},e.prototype.turnTop=function(t){t.y>this.stageH+this.spaceH&&(t.y=-this.lineH)},Object.defineProperty(e.prototype,"spaceLW",{get:function(){return this._spaceLW},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Background.prototype,"Background");var UIHelper=function(){function t(){}return Object.defineProperty(t,"RED",{get:function(){return t.colors[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BLUE",{get:function(){return t.colors[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ORANGE",{get:function(){return t.colors[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PURPLE",{get:function(){return t.colors[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"GREEN",{get:function(){return t.colors[4]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"YELLOW",{get:function(){return t.colors[5]},enumerable:!0,configurable:!0}),t.getRandomColor=function(){var e=Math.floor(6*Math.random());return t.colors[e]},t.getCarBMP=function(e,i){var r="car"+e+"_"+i+"_png";return t.createBitmapByName(r)},t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.colors=["red","blue","orange","purple","green","yellow"],t}();__reflect(UIHelper.prototype,"UIHelper");var Constants=function(){function t(){}return t.spaceLW=0,t.stageH=0,t.stageW=0,t}();__reflect(Constants.prototype,"Constants");var UIConsts=function(){function t(){}return t.LAYER_START_GAME="StartGameLayer",t.LAYER_GAME_OVER="GameOverLayer",t.LAYER_GAMING="GamingLayer",t}();__reflect(UIConsts.prototype,"UIConsts");var Toast=function(t){function e(i,r,n){var s=t.call(this)||this,o=new egret.Bitmap(e._txtrToastBg);s.addChild(o);var a=new egret.TextField;return a.multiline=!0,a.size=40,a.bold=!0,a.textColor=16777215,a.stroke=2,a.strokeColor=0,a.text=i,a.fontFamily="微软雅黑",a.textAlign=egret.HorizontalAlign.CENTER,a.width=.84*r,a.x=(e._txtrToastBg.textureWidth-a.width)/2,a.y=6,s.addChild(a),o.height=12+a.height,s.anchorOffsetX=.5*s.width,s.anchorOffsetY=.5*s.height,s.x=.5*r,s.y=.618*n,s.alpha=0,s.touchEnabled=!1,s.touchChildren=!1,egret.Tween.get(s).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){s.parent&&s.parent.removeChild(s)}),s}return __extends(e,t),e.init=function(t,e){this._cont=t,this._txtrToastBg=e},e.launch=function(t){if(this._cont){var i=new e(t,this._cont.stage.stageWidth,this._cont.stage.stageHeight);this._cont.addChild(i)}},e}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameOverLayer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.uiCompHandler=function(){this.txt_final_score.text="太棒了！你的成绩是"+gc.gameCenter.score+"m,超过了全国99%的老司机"},e.prototype._tap_btn_restart=function(){gc.gameCenter.restartGame()},e}(EuiComponent);__reflect(GameOverLayer.prototype,"GameOverLayer");var GamingLayer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.uiCompHandler=function(){var t=this,e=this;e.readText=["THREE","TWO","ONE"],e.cur_read_index=0,gc.gameCenter.cur_status=GameCenter.STATUS_NOT_READY,this.txt_ready.visible=!0,e.cur_read_index=0,e.txt_ready.text=this.readText[e.cur_read_index],e.cur_read_index++,e._startAnim=egret.setInterval(function(){e.cur_read_index<t.readText.length?(e.txt_ready.text=t.readText[e.cur_read_index],e.cur_read_index++):(gc.gameCenter.cur_status=GameCenter.STATUS_RUNNING,e.txt_ready.visible=!1,egret.clearInterval(t._startAnim))},this,1e3)},e.prototype.updateUI=function(t){var e=gc.gameCenter.score,i=gc.gameCenter.speed;this.txt_speed.text=i+"h/s",this.txt_score.text=e+"m"},e}(EuiComponent);__reflect(GamingLayer.prototype,"GamingLayer");var StartGameLayer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.uiCompHandler=function(){},e.prototype._tap_btn_start=function(){gc.gameCenter.startGame()},e.prototype._tap_btn_rank=function(){Toast.launch("抱歉还没做！")},e}(EuiComponent);__reflect(StartGameLayer.prototype,"StartGameLayer");var gc;!function(t){}(gc||(gc={}));var UIController=function(){function t(t){this.layer_parent=t}return t.prototype.showLayer=function(t){this.removeAll();var e=egret.getDefinitionByName(t),i=new e;this.cur_layer=i,this.layer_parent.addChild(i)},t.prototype.removeAll=function(){this.cur_layer&&this.cur_layer.parent&&(this.cur_layer.parent.removeChild(this.cur_layer),this.cur_layer.removeBtnListeners())},t}();__reflect(UIController.prototype,"UIController");